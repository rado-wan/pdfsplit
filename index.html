<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Page Extractor</title>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f7f6;
            margin: 0;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
        }
        h2 { color: #333; margin-top: 0; font-size: 1.5rem; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #555; }
        input[type="text"], input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #status { margin-top: 1rem; font-size: 0.9rem; text-align: center; }
        .hint { font-size: 0.8rem; color: #888; margin-top: 4px; }
    </style>
</head>
<body>

<div class="container">
    <h2>PDF Page Extractor</h2>
    
    <div class="form-group">
        <label for="pdf-file">Select PDF File</label>
        <input type="file" id="pdf-file" accept="application/pdf">
    </div>

    <div class="form-group">
        <label for="page-range">Page Ranges</label>
        <input type="text" id="page-range" placeholder="e.g. 1-3, 5, 8-10">
        <div class="hint">Use commas for separate pages and dashes for ranges.</div>
    </div>

    <div class="form-group">
        <label for="file-name">Output File Name</label>
        <input type="text" id="file-name" placeholder="extracted_pages.pdf" value="extracted_pages.pdf">
    </div>

    <button id="process-btn">Extract and Download</button>

    <div id="status"></div>
</div>

<script>
    const { PDFDocument } = PDFLib;

    document.getElementById('process-btn').addEventListener('click', async () => {
        const fileInput = document.getElementById('pdf-file');
        const rangeInput = document.getElementById('page-range').value;
        const fileNameInput = document.getElementById('file-name').value;
        const status = document.getElementById('status');
        const btn = document.getElementById('process-btn');

        if (fileInput.files.length === 0) {
            alert('Please select a PDF file first.');
            return;
        }

        if (!rangeInput.trim()) {
            alert('Please enter page ranges.');
            return;
        }

        try {
            btn.disabled = true;
            status.textContent = "Processing... please wait.";
            status.style.color = "blue";

            // 1. Load the existing PDF
            const file = fileInput.files[0];
            const arrayBuffer = await file.arrayBuffer();
            const srcPdf = await PDFDocument.load(arrayBuffer);
            const totalPages = srcPdf.getPageCount();

            // 2. Create a new PDF
            const outPdf = await PDFDocument.create();

            // 3. Parse the range string (e.g., "1-3, 5, 8-10")
            const pagesToExtract = parsePageRanges(rangeInput, totalPages);

            if (pagesToExtract.length === 0) {
                throw new Error("No valid pages found in the range provided.");
            }

            // 4. Copy pages from Source to Output
            // Note: pdf-lib uses 0-based indexing for copying
            const copiedPages = await outPdf.copyPages(srcPdf, pagesToExtract.map(p => p - 1));
            copiedPages.forEach(page => outPdf.addPage(page));

            // 5. Serialize the PDF to bytes
            const pdfBytes = await outPdf.save();

            // 6. Trigger Download
            download(pdfBytes, fileNameInput.endsWith('.pdf') ? fileNameInput : fileNameInput + '.pdf', "application/pdf");

            status.textContent = "Success! Your file has been generated.";
            status.style.color = "green";
        } catch (err) {
            console.error(err);
            status.textContent = "Error: " + err.message;
            status.style.color = "red";
        } finally {
            btn.disabled = false;
        }
    });

    // Helper function to turn "1-3, 5" into [1, 2, 3, 5]
    function parsePageRanges(input, maxPages) {
        const result = new Set();
        const parts = input.split(',');

        parts.forEach(part => {
            part = part.trim();
            if (part.includes('-')) {
                const [start, end] = part.split('-').map(Number);
                if (!isNaN(start) && !isNaN(end)) {
                    for (let i = Math.max(1, start); i <= Math.min(end, maxPages); i++) {
                        result.add(i);
                    }
                }
            } else {
                const page = Number(part);
                if (!isNaN(page) && page >= 1 && page <= maxPages) {
                    result.add(page);
                }
            }
        });

        return Array.from(result).sort((a, b) => a - b);
    }

    // Standard download trigger
    function download(data, filename, type) {
        const file = new Blob([data], { type: type });
        const a = document.createElement("a");
        const url = URL.createObjectURL(file);
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }, 0);
    }
</script>

</body>
</html>
